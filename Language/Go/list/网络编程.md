# 网络编程

## TCP

* server

```go
func Server() {
	lis, err := net.Listen("tcp", "127.0.0.1:9090")
	if err != nil {
		log.Panic(err)
	}

	go func() {
		for {
			conn, err := lis.Accept()
			if err != nil {
				fmt.Println("accept failed, err:", err)
				continue
			}
			go process(conn)
		}
	}()
}

func process(conn net.Conn) {
	defer conn.Close()
	for {
		var buf [128]byte
		n, err := conn.Read(buf[:])
		if err != nil {
			fmt.Println("read from client failed, err:", err)
			break
		}
		recvStr := string(buf[:n])
		fmt.Println("client to server: ", recvStr)
		conn.Write([]byte("server to client: " + recvStr))
	}
}
```

* client

```go
func Client() {
	conn, err := net.Dial("tcp", "127.0.0.1:9090")
	if err != nil {
		fmt.Println("err :", err)
		return
	}
	defer conn.Close()
	read := bufio.NewReader(os.Stdin)
	for {
		input, _ := read.ReadString('\n')
		inputInfo := strings.Trim(input, "\r\n")
		if strings.ToUpper(inputInfo) == "Q" {
			return
		}
		_, err = conn.Write([]byte(inputInfo))
		if err != nil {
			return
		}
		buf := [512]byte{}
		n, err := conn.Read(buf[:])
		if err != nil {
			fmt.Println("recv failed, err: ", err)
			return
		}
		fmt.Println(string(buf[:n]))
	}
}
```

## UDP

* server

```go
func Server() {
	listenUDP, err := net.ListenUDP("udp", &net.UDPAddr{
		IP:   net.IPv4(127, 0, 0, 1),
		Port: 9090,
	})
	if err != nil {
		fmt.Println("listen failed, err:", err)
		return
	}
	defer listenUDP.Close()

	for {
		var data [1024]byte
		n, addr, err := listenUDP.ReadFromUDP(data[:]) // 接收数据
		if err != nil {
			fmt.Println("read udp failed, err:", err)
			continue
		}
		fmt.Printf("data:%v addr:%v count:%v\n", string(data[:n]), addr, n)
		_, err = listenUDP.WriteToUDP(data[:n], addr) // 发送数据
		if err != nil {
			fmt.Println("write to udp failed, err:", err)
			continue
		}
	}
}
```

* client

```go
func Client() {
	udpConn, err := net.DialUDP("udp", nil, &net.UDPAddr{
		IP:   net.IPv4(127, 0, 0, 1),
		Port: 9090,
	})
	if err != nil {
		fmt.Println("连接服务端失败，err:", err)
		return
	}
	defer udpConn.Close()
	sendData := []byte("Hello server")
	_, err = udpConn.Write(sendData) // 发送数据
	if err != nil {
		fmt.Println("发送数据失败，err:", err)
		return
	}
	data := make([]byte, 4096)
	n, remoteAddr, err := udpConn.ReadFromUDP(data) // 接收数据
	if err != nil {
		fmt.Println("接收数据失败，err:", err)
		return
	}
	fmt.Printf("recv:%v addr:%v count:%v\n", string(data[:n]), remoteAddr, n)
}
```

## HTTP

* server

```go
func Server() {
	http.HandleFunc("/hello01", func(w http.ResponseWriter, r *http.Request) {
		fmt.Println(r.RemoteAddr, "连接成功")
		// 请求方式：GET POST DELETE PUT UPDATE
		fmt.Println("method:", r.Method)
		fmt.Println("url:", r.URL.Path)
		fmt.Println("header:", r.Header)
		fmt.Println("body:", r.Body)
		// 回复
		w.Write([]byte("hang"))
	})

	http.Handle("/hello02", &MyHandler{})

	http.ListenAndServe(":8080", nil)
}

type MyHandler struct {
}

func (*MyHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {
	fmt.Println("123")
}
```

* client

```go
func Client() {
	resp, _ := http.Get("https://www.baidu.com")
	defer resp.Body.Close()

	readAll, _ := ioutil.ReadAll(resp.Body)

	fmt.Println(string(readAll))
}
```
